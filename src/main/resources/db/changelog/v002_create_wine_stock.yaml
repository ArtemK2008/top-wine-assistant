databaseChangeLog:
  - changeSet:
      id: v002-create-wine-stock
      author: you
      preConditions:
        onFail: MARK_RAN
        onError: HALT
        and:
          - dbms: { type: postgresql }
          - not:
              tableExists:
                tableName: wine_stock

      changes:
        - createTable:
            tableName: wine_stock
            remarks: "Остатки вина на складе ресторана"
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    primaryKeyName: pk_wine_stock
                    nullable: false

              - column:
                  name: wine_id
                  type: BIGINT
                  remarks: "Ссылка на карточку вина"
                  constraints:
                    nullable: false
                    foreignKeyName: fk_wine_stock_item
                    references: wine_item(id)
                    deleteCascade: true

              - column:
                  name: location_name
                  type: TEXT
                  defaultValue: 'main_cellar'
                  constraints:
                    nullable: false

              - column:
                  name: quantity_bottles
                  type: INT
                  defaultValueNumeric: 0
                  constraints:
                    nullable: false

              - column:
                  name: price_rub
                  type: NUMERIC(10,2)
                  remarks: "Цена за бутылку (₽)"
                  constraints:
                    nullable: false

              - column:
                  name: updated_at
                  type: TIMESTAMPTZ
                  defaultValueComputed: now()
                  constraints:
                    nullable: false

      rollback:
        - dropTable:
            tableName: wine_stock
            cascadeConstraints: true
